# Интеграция внешних пользователей
Для связи с внешними пользователями мы используем Телеграм, конкретнее - механизм **deep linking**.

Суть очень простая. Мы даем пользователю специально сформированную ссылку, в параметрах которой зашиты необходимые нам параметры.

Таким образом, человек попадает на лид-форму, оставляет там свои данные (номер телефона, email, имя и т.д.). Мы формируем ссылку вида

https://t.me/goit_programmer_bot?start=ED-20200509__TG-MARATHON__PH-093-98-10458

и редиректим человека по этой ссылке (предупредив, что нужно будет сейчас в Телеграм боте нажать кнопку Старт). 

Человеку предложит открыть Телеграм, он откроет его, нажмет кнопку Старт, и данные, что мы передавали по ссылке, привяжутся к нему. Все - он у нас в базе, и мы можем слать ему оповещения.

## Передача параметров
Параметры передаются в виде **КЛЮЧ-ЗНАЧЕНИЕ**. Отдельные пары ключей-значений разделяются двойным символом подчеркивания  **__**.

Возможные параметры для передачи:
- **ED** - дата события. Может быть дата марафона, или любая другая значащая для нас дата. Если передать **NOW** - будет установлена текущая дата (на момент регистрации).
- **TG** - тег человека. Для разделения, что в дальнейшем делать с этим человека (например, 5-дневный марафон, самостоятельный продукт и т.д.)
- **PH** - телефон, который ввел человек. Обязательно его передавать, именно по этому мы будем идентифицировать наших пользователей.
- **EM** - электронная почта

Все имена параметров и их значения должны содержать только латинские буквы, цифры и символы -_.

Телеграм позволяет передать суммарно строку **длиной максимум в 64 символа**. Это мало, поэтому следует передать в строке запроса лишь два основные параметры - телефон и тег. Остальные параметры нужно отослать другим способом - через REST API на бекенд. 

По сути, это значит отправить GET запрос на адрес **https://checkhtmlbackend.com/api/v2/tguser/setInfo** со следующими параметрами:
- **phone** - номер телефона, по которому мы идентифицируем пользователя;
- **firstName** - как зовут нашего пользователя
- **email** - электронная почта пользователя.

Например:
https://checkhtmlbackend.com/api/v2/tguser/setInfo?phone=0939810458&email=user@gmail.com&firstName=Иван